<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{wearivalayout::layout(~{::section})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <section class="py-10">
      <div class="relative w-full flex flex-col items-center justify-center">
        <p
          id="update-message"
          class="fade-in absolute -top-10 right-0 left-0 h-9 w-0 text-nowrap overflow-hidden mx-auto flex justify-center items-center bg-darknavi text-white rounded-lg transition-all duration-1000"
        ></p>
        <form
          class="w-[95%] md:w-[70%] flex flex-col items-center justify-center"
          id="update-profile"
          th:object="${authenticatedUser}"
        >
          <h2
            class="text-3xl text-darknavi font-medium first-letter:text-lighnavi"
          >
            Update Profile
          </h2>
          <p class="text-sm text-gray-500/90">
            [[${authenticatedUser.name}]], Please update your profile here.
          </p>

          <div class="grid grid-cols-2 w-full gap-3 mt-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2 backdrop-blur-sm"
            >
              <input
                type="text"
                name="name"
                placeholder="Name"
                th:field="*{name}"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>

            <div
              class="relative flex items-center w-full bg-lightgrey/20 border border-darknavi h-12 mt-2 rounded-full px-4 gap-2"
            ><p class="text-xs absolute -top-5 right-3 text-red-500">Warning! Change it if it is really Required.*</p>
              <input
                type="text"
                name="username"
                th:field="*{username}"
                placeholder="Username"
                class="bg-transparent text-black placeholder-stone-800/80 outline-none text-lg w-full h-full"
                required
              />
            </div>
          </div>

          <div class="grid grid-cols-2 w-full gap-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="email"
                name="email"
                th:field="*{email}"
                placeholder="Email Address"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="number"
                name="phone"
                th:field="*{phone}"
                maxlength="10"
                placeholder="Phone Number"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
          </div>

          <div class="grid grid-cols-2 w-full gap-3">
            <div
              class="flex items-center mt-2 w-full bg-transparent border border-stone-600/60 h-12 rounded-full overflow-hidden px-4 gap-2"
            >
              <select
                name="gender"
                id="gender"
                th:field="*{gender}"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              >
                <option value="No Selected" selected>Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
            <div
              class="flex items-center w-full border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="city"
                th:field="*{city}"
                placeholder="City"
                name="city"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 w-full gap-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="state"
                th:field="*{state}"
                placeholder="State"
                name="state"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="pin"
                th:field="*{pin}"
                placeholder="PinCode"
                name="pin"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>
          </div>

          <button
            type="submit"
            class="mt-3 w-full h-11 rounded-full text-white bg-darknavi hover:bg-lighnavi duration-300 transition-colors"
          >
            Update
          </button>
        </form>
      </div>

      <script th:inline="javascript">
        const updateProfile = document.getElementById("update-profile");
        updateProfile.onsubmit = async (e) => {
          e.preventDefault();
          const formData = new FormData();
          formData.append("name", updateProfile.name.value);
          formData.append("username", updateProfile.username.value);
          formData.append("email", updateProfile.email.value);
          formData.append("phone", updateProfile.phone.value);
          formData.append("gender", updateProfile.gender.value);
          formData.append("city", updateProfile.city.value);
          formData.append("state", updateProfile.state.value);
          formData.append("pin", updateProfile.pin.value);

          const response = await fetch(
            "http://localhost:8080/api/user/updateprofile",
            {
              method: "POST",
              body: formData,
              credentials: "include",
            }
          );
          const { flag, message } = await response.json();
          const news = document.getElementById("update-message");
          news.innerText = flag ? message : message;
          news.style.width = "0px";
          news.style.width = "50%";
          news.style.padding = "5px";
          news.classList.add("tracking-in-expand");
          setTimeout(() => {
            news.innerText = "";
            news.style.width = "0px";
            news.style.border = "none";
            news.style.paddingInline = "0px";
            setTimeout(()=>{
              location.assign('/user/profiledetails')
            },1000)
            
          }, 3000);
        };
      </script>
    </section>
  </body>
</html>
