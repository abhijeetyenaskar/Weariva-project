<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{wearivalayout::layout(~{::section})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <section class="select-none bg-white/30 py-6 px-3">
      <div class="">
        <div class="bg-white/30 flex flex-col gap-3">
          <div class="bg-white/40 rounded-lg">
            <div class="p-2 bg-white/40">
              <h1 class="text-xl mb-2 text-darknavi border-b border-navi">
                Cart Items
              </h1>
              <div class="w-full text-xs md:text-sm flex flex-col gap-2">
                <div
                  th:each="cart,c :${cartItems}"
                  class="grid grid-cols-9 border py-2 px-2 rounded-full"
                >
                  <p class="px-2 py-0.5">[[${c.index + 1}]].</p>
                  <p class="px-2 py-0.5 col-span-6">
                    [[${cart.product.name}]] x (
                    <span class="text-lightgrey">[[${cart.quantity}]]</span> )
                  </p>
                  <p class="px-2 py-0.5 col-span-2 text-right w-22 font-medium">
                    $ [[${cart.quantity * cart.product.discountedPrice}]]
                  </p>
                </div>
                <div class="grid grid-cols-4 border py-2 px-2 rounded-full">
                  <p class="px-2 py-0.5 col-span-3">Delivery Fees</p>
                  <p class="px-2 py-0.5 text-right font-medium">$ 20</p>
                </div>
                <div
                  class="grid grid-cols-4 bg-darknavi text-white font-medium border py-2 px-2 rounded-full"
                >
                  <p class="px-2 py-0.5 col-span-3">Total Amount</p>
                  <p class="px-2 py-0.5 text-right">
                    $ [[${(totalcartvalue > 0 ? totalcartvalue : 0) + 20}]]
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="px-3">
            <h2 class="text-xl border-b border-stone-700">Delivery Address</h2>
            <form id="place-order-form">
              <div
                class="flex items-center w-full bg-transparent border border-stone-600/60 h-10 mt-1 rounded-full overflow-hidden px-4 gap-2"
              >
                <input
                  type="text"
                  name="street"
                  placeholder="Street No / Apartment No / Building No"
                  class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                  required
                />
              </div>

              <div
                class="w-full bg-transparent grid grid-cols-2 md:grid-cols-4 mt-1 rounded-full gap-2"
              >
                <div
                  class="flex items-center w-full bg-transparent border border-stone-600/60 h-10 rounded-full overflow-hidden px-4 gap-2"
                >
                  <input
                    type="text"
                    name="city"
                    placeholder="City"
                    class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                    required
                  />
                </div>
                <div
                  class="flex items-center w-full bg-transparent border border-stone-600/60 h-10 rounded-full overflow-hidden px-4 gap-2"
                >
                  <input
                    type="text"
                    name="state"
                    placeholder="State"
                    class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                    required
                  />
                </div>
                <div
                  class="flex items-center w-full bg-transparent border border-stone-600/60 h-10 rounded-full overflow-hidden px-4 gap-2"
                >
                  <input
                    type="text"
                    name="country"
                    placeholder="Country"
                    class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                    required
                  />
                </div>
                <div
                  class="flex items-center w-full bg-transparent border border-stone-600/60 h-10 rounded-full overflow-hidden px-4 gap-2"
                >
                  <input
                    type="text"
                    name="phone"
                    placeholder="Phone"
                    class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                    required
                  />
                </div>
              </div>
              <div
                class="flex gap-5 items-center w-full bg-transparent h-10 mt-1 rounded-full overflow-hidden px-4"
              >
                <label class="flex gap-3 items-center cursor-pointer relative">
                  <input
                    type="radio"
                    name="paymentmode"
                    checked
                    value="cod"
                    class="payment-mode hidden peer"
                  />
                  <span
                    class="w-5 h-5 border border-slate-300 rounded relative flex items-center justify-center peer-checked:border-stone-600"
                  >
                  </span>
                  <span
                    class="w-5 h-5 absolute left-0 justify-center items-center text-xs peer-checked:flex hidden peer-checked:text-stone-600"
                  >
                    <i class="fa-solid fa-check"></i>
                  </span>
                  <span class="text-gray-700 select-none"
                    >Cash On Delivery</span
                  >
                </label>
                <label class="flex gap-3 items-center cursor-pointer relative">
                  <input
                    type="radio"
                    name="paymentmode"
                    value="online"
                    class="payment-mode hidden peer"
                  />
                  <span
                    class="w-5 h-5 border border-slate-300 rounded relative flex items-center justify-center peer-checked:border-stone-600"
                  >
                  </span>
                  <span
                    class="w-5 h-5 absolute left-0 justify-center items-center text-xs peer-checked:flex hidden peer-checked:text-stone-600"
                  >
                    <i class="fa-solid fa-check"></i>
                  </span>
                  <span class="text-gray-700 select-none">Online Payment</span>
                </label>
              </div>
              <button
                id="place-order-btn"
                type="submit"
                class="transition-all border py-1 px-5 rounded-full block mt-1 bg-darknavi hover:bg-navi text-white duration-300"
              >
                Place Order
              </button>
            </form>
            <script>
              const paymentMode = document.querySelectorAll(".payment-mode");
              paymentMode.forEach((element) => {
                element.onclick = (e) => {
                  if (element.value === "online") {
                    document.getElementById("place-order-btn").innerText =
                      "Pay";
                  } else {
                    document.getElementById("place-order-btn").innerText =
                      "Place Order";
                  }
                };
              });

              /* form handle */
              const placeorderform =
                document.getElementById("place-order-form");
              placeorderform.onsubmit = async (e) => {
                e.preventDefault();

                const orders = {
                  street: placeorderform.street.value,
                  city: placeorderform.city.value,
                  state: placeorderform.state.value,
                  country: placeorderform.country.value,
                  phone: placeorderform.phone.value,
                  paymentmode: placeorderform.paymentmode.value,
                };
                const response = await fetch(
                  "http://localhost:8080/api/user/place-order",
                  {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify(orders),
                    credentials: "include",
                  }
                );
                const {flag,message} = await response.json();
                if(flag){
                  location.assign("/user/myorders")
                }else{
                  
                  location.assign("/user/checkout")
                }
              };
            </script>
          </div>
        </div>
      </div>
    </section>
  </body>
</html>
