<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{wearivalayout::layout(~{::section})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        color: gray;
      }
    </style>
  </head>
  <body>
    <section class="p-3 relative">
      <p
        id="adminmessage"
        class="absolute left-0 right-0 text-black text-center w-0 overflow-hidden text-nowrap mx-auto border z-[5000] bg-white rounded-lg transition-all duration-700"
      >
        Message Appreas here
      </p>
      <div
        id="add-admin-form"
        class="fixed top-0 left-0 right-0 z-[5000] overflow-hidden bg-white flex h-0 bottom-0 flex-col items-center justify-center transition-all duration-700"
      >
        <button
          id="admin-form-close"
          class="absolute top-5 rounded-full right-5 px-4 py-0 5 text-xs bg-darknavi text-white"
        >
          Close
        </button>

        <form
          id="adminadd"
          class="w-[95%] md:w-[70%] flex flex-col items-center justify-center"
        >
          <h2 class="text-5xl text-darknavi font-medium first-letter:text-navi">
            Weariva Admin
          </h2>
          <p class="text-sm text-gray-500/90 mt-3">
            Welcome back! Please sign up to continue
          </p>
          <p
            id="message"
            class="absolute top-2 right-3 tracking-in-expand text-stone-500"
          ></p>

          <div class="grid grid-cols-2 w-full gap-3 mt-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                name="name"
                placeholder="Name"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>

            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                name="username"
                placeholder="Username"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
          </div>

          <div class="grid grid-cols-2 w-full gap-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="email"
                name="email"
                placeholder="Email Address"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
            <div
              class="flex items-center mt-2 w-full bg-transparent border border-stone-600/60 h-12 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="password"
                placeholder="Password"
                name="password"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
          </div>

          <div class="grid grid-cols-2 w-full gap-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="number"
                name="phone"
                maxlength="10"
                placeholder="Phone Number"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
                required
              />
            </div>
            <div
              class="flex items-center mt-2 w-full bg-transparent border border-stone-600/60 h-12 rounded-full overflow-hidden px-4 gap-2"
            >
              <select
                name="gender"
                id="gender"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full cursor-pointer"
              >
                <option value="No Selected" selected>Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-3 w-full gap-3">
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="city"
                placeholder="City"
                name="city"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>

            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="state"
                placeholder="State"
                name="state"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>
            <div
              class="flex items-center w-full bg-transparent border border-stone-600/60 h-12 mt-2 rounded-full overflow-hidden px-4 gap-2"
            >
              <input
                type="text"
                required
                id="pin"
                placeholder="PinCode"
                name="pin"
                class="bg-transparent text-stone-800/80 placeholder-stone-800/80 outline-none text-sm w-full h-full"
              />
            </div>
          </div>

          <button
            type="submit"
            class="mt-3 w-full h-11 rounded-full text-white bg-darknavi hover:bg-navi duration-300 transition-colors"
          >
            Add Admin
          </button>
        </form>
      </div>
      <div class="p-3 bg-white/30 backdrop-blur-md">
        <div class="flex flex-col gap-3 w-full p-2 bg-white/40">
          <div class="flex justify-between items-center">
            <h1 class="text-3xl border-b pb-2">Admins</h1>
            <button
              id="add-admin-btn"
              class="px-4 py-0.5 bg-darknavi text-white text-xs rounded-full hover:scale-105 hover:bg-navi active:scale-100"
            >
              Add
            </button>
          </div>
          <script>
            const formAdmin = document.getElementById("add-admin-form");
            document.getElementById("add-admin-btn").onclick = (e) => {
              formAdmin.classList.remove("h-0");
              formAdmin.classList.add("h-full");
            };
            document.getElementById("admin-form-close").onclick = (e) => {
              formAdmin.classList.remove("h-full");
              formAdmin.classList.add("h-0");
            };
          </script>
          <th:block th:if="${admindetails}">
            <div id="admins-container" class="flex flex-col gap-2">
              <div
                class="admin-list-items p-1 duration-300 rounded-full cursor-pointer flex justify-between items-center px-2 gap-5 shadow-md relative bg-white/60"
                th:each="user : ${admindetails}"
                th:classappend="${user.userActive ? 'hover:bg-lightgrey/20' : 'hover:bg-red-50/50'}"
                th:id="'admin-record-'+${user.userId}"
              >
                <div class="flex items-center justify-center relative">
                  <span
                    class="absolute top-0 left-0 z-20 w-2 h-2 rounded-full animate-ping"
                    th:classappend="${user.loggedIn ? 'bg-green-500' : 'bg-red-500'}"
                  ></span>
                  <span
                    class="absolute top-0 left-0 w-2 h-2 rounded-full z-40"
                    th:classappend="${user.loggedIn ? 'bg-green-500' : 'bg-red-500'}"
                  ></span>
                  <div
                    class="w-10 h-10 flex-1 p-1 rounded-full bg-white overflow-hidden shadow-inner"
                    th:classappend="${user.userActive ? 'shadow-stone-600' : 'shadow-red-300'}"
                  >
                    <img
                      class="object-cover h-full rounded-full shadow-md fade-in"
                      th:classappend="${user.userActive ? 'shadow-green-950' : 'shadow-red-950'}"
                      th:src="@{'/images/uploads/profiles/profile.png'}"
                      alt=""
                    />
                  </div>

                  <div class="px-2">
                    <p
                      class="text-xl"
                      th:classappend="${user.userActive ? 'text-stone-950 first-letter:text-stone-600' : 'first-letter:text-red-600 text-red-950'}"
                      th:title="${user.username}"
                    >
                      [[${user.name}]]
                    </p>
                    <p class="text-xs text-darknavi">[[${user.email}]]</p>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button
                    th:id="'admin-activation-'+${user.userId}"
                    class="px-2 py-1.5 rounded-full my-2 border backdrop-blur-md text-xs hover:scale-105 active:scale-100 z-20 hover:text-xs"
                    th:classappend="${user.userActive ? 'border border-stone-500 bg-stone-50 first-letter:text-stone-800' : 'border border-red-500 bg-red-50 first-letter:text-red-800'}"
                  >
                    [[${user.userActive ? "Activate" : "Deactivate"}]]
                  </button>

                  <button
                    th:id="'admin-remove-'+${user.userId}"
                    class="px-2 py-1.5 rounded-full my-2 border border-stone-500 bg-darknavi text-white hover:scale-105 active:scale-100 z-20 hover:text-xs backdrop-blur-md text-xs"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </th:block>
          <th:block th:unless="${admindetails}">
            <h1 class="text-3xl">Admin's Not Found</h1>
          </th:block>
        </div>
      </div>
      <script>
        function applyEvent() {
          const list = document.querySelectorAll(".admin-list-items");
          console.log(list.length);
          for (const element of list) {
            const id = element.id.substring(element.id.lastIndexOf("-") + 1);
            element.children[1].children[0].onclick = (e) => {
              console.log("Active Status : " + id);
              changeActiveStatus(id);
            };
            element.children[1].children[1].onclick = (e) => {
              console.log("Delete Status : " + id);
              deleteAdmin(id);
            };
          }
        }

        async function changeActiveStatus(adminId) {
          try {
            console.log(adminId);
            const sendingData = new FormData();
            sendingData.append("id", Number(adminId));
            const response = await fetch(
              "http://localhost:8080/api/admin/change-admin-active",
              { method: "POST", body: sendingData, credentials: "include" }
            );
            const { flag, message } = await response.json();

            const messageDom = document.getElementById("adminmessage");
            if (flag) {
              messageDom.textContent = message;
              messageDom.style.width = "60%";

              // document ui change
              const activeStatusChange = document.getElementById(
                `admin-activation-${adminId}`
              );
              activeStatusChange.innerText =
                activeStatusChange.innerText === "Activate"
                  ? "Deactivate"
                  : "Activate";

              activeStatusChange.style.borderColor =
                activeStatusChange.innerText === "Activate" ? "gray" : "red";
              setTimeout(() => {
                messageDom.textContent = "";
                messageDom.style.width = "0px";
              }, 2000);
            } else {
              throw new Error(message);
            }
          } catch (error) {
            const messageDom = document.getElementById("adminmessage");
            messageDom.textContent = error?.message;
            messageDom.style.width = "60%";
            setTimeout(() => {
              messageDom.textContent = "";
              messageDom.style.width = "0px";
            }, 2000);
          }
        }

        async function deleteAdmin(adminId) {
          try {
            console.log(adminId);
            const sendingData = new FormData();
            sendingData.append("id", Number(adminId));
            const response = await fetch(
              "http://localhost:8080/api/admin/delete-admin",
              { method: "POST", body: sendingData, credentials: "include" }
            );
            const { flag, message } = await response.json();

            const messageDom = document.getElementById("adminmessage");
            if (flag) {
              messageDom.textContent = message;
              messageDom.style.width = "60%";
              document.getElementById(`admin-record-${adminId}`).remove();
              setTimeout(() => {
                messageDom.textContent = "";
                messageDom.style.width = "0px";
              }, 2000);
            } else {
              throw new Error(message);
            }
          } catch (error) {
            const messageDom = document.getElementById("adminmessage");
            messageDom.textContent = error?.message;
            messageDom.style.width = "60%";
            setTimeout(() => {
              messageDom.textContent = "";
              messageDom.style.width = "0px";
            }, 2000);
          }
        }

        function createElements(adminInfo, id) {
          const divMain = document.createElement("div");
          divMain.id = `admin-record-${id}`;
          divMain.className =
            "admin-list-items p-1 border duration-300 rounded-full cursor-pointer flex justify-between items-center px-2 gap-5 shadow-md relative bg-white/60 hover:bg-lightgrey/20";

          const divFirstChild = document.createElement("div");
          divFirstChild.className = "flex items-center justify-center relative";

          const spanFirstFirstChildDiv = document.createElement("span");
          spanFirstFirstChildDiv.className =
            "absolute top-0 left-0 z-20 w-2 h-2 rounded-full bg-green-500";
          const spanSecondFirstChildDiv = document.createElement("span");
          spanSecondFirstChildDiv.className =
            "absolute top-0 left-0 w-2 h-2 rounded-full z-40 bg-green-500";
          // second div
          const subSecondDivChild = document.createElement("div");
          subSecondDivChild.className =
            "w-10 h-10 flex-1 p-1 rounded-full bg-white overflow-hidden shadow-inner shadow-stone-600";
          const imgComponent = document.createElement("img");
          imgComponent.className =
            "object-cover h-full rounded-full shadow-md fade-in";
          imgComponent.setAttribute(
            "src",
            "/images/uploads/profiles/profile.png"
          );

          subSecondDivChild.append(imgComponent);

          // third div
          const subThirdDivChild = document.createElement("div");
          subThirdDivChild.className = "px-2";

          const paraOne = document.createElement("p");
          paraOne.className =
            "text-xl text-stone-950 first-letter:text-stone-600";
          paraOne.textContent = adminInfo?.name;

          const paraTwo = document.createElement("p");
          paraTwo.className = "text-xs text-darknavi";
          paraTwo.textContent = adminInfo?.email;

          subThirdDivChild.append(paraOne, paraTwo);
          divFirstChild.append(
            spanFirstFirstChildDiv,
            spanSecondFirstChildDiv,
            subSecondDivChild,
            subThirdDivChild
          );

          const secondMainDiv = document.createElement("div");
          secondMainDiv.className = "flex gap-2";
          const activeBtn = document.createElement("button");
          activeBtn.id = `admin-activation-${id}`;
          activeBtn.className =
            "px-2 py-1.5 rounded-full my-2 backdrop-blur-md text-xs border border-stone-500 bg-stone-50 first-letter:text-stone-800 hover:scale-105 active:scale-100 z-20 hover:text-xs";
          activeBtn.textContent = "Deactivate";

          const removeBtn = document.createElement("button");
          removeBtn.id = `admin-remove-${id}`;
          removeBtn.className =
            "px-2 py-1.5 rounded-full my-2 backdrop-blur-md text-xs border border-stone-500 bg-stone-50 first-letter:text-stone-800 hover:scale-105 active:scale-100 z-20 hover:text-xs";
          removeBtn.textContent = "Remove";
          secondMainDiv.append(activeBtn, removeBtn);

          divMain.append(divFirstChild, secondMainDiv);

          return divMain;
        }

        document.addEventListener("DOMContentLoaded", () => {
          const form = document.getElementById("adminadd");
          form.addEventListener("submit", async (e) => {
            try {
              e.preventDefault();
              const formData = {
                name: form.name.value,
                username: form.username.value,
                email: form.email.value,
                password: form.password.value,
                phone: form.phone.value,
                gender: form.gender.value,
                city: form.city.value,
                state: form.state.value,
                pin: form.pin.value,
              };
              const response = await fetch(
                "http://localhost:8080/api/admin/uploadsadmin",
                {
                  method: "POST",
                  body: JSON.stringify(formData),
                  headers: { "Content-Type": "application/json" },
                  credentials: "include",
                }
              );
              const { flag, message } = await response.json();
              if (flag) {
                document.getElementById("adminmessage").innerText =
                  "Successfully Added!!";
                setTimeout(() => {
                  document.getElementById("adminmessage").innerText = "";
                }, 2000);
                document
                  .getElementById("admins-container")
                  .appendChild(createElements(formData, message));
                form.reset();
                const formAdmin = document.getElementById("add-admin-form");
                formAdmin.classList.remove("h-full");
                formAdmin.classList.add("h-0");
                applyEvent();
              } else {
                document.getElementById("adminmessage").innerText = message;
                setTimeout(() => {
                  document.getElementById("adminmessage").innerText = "";
                }, 2000);
              }
            } catch (error) {
              console.log(error);
              document.getElementById("adminmessage").innerText =
                "Submit Admin Information Failed";
              setTimeout(() => {
                document.getElementById("adminmessage").innerText = "";
              }, 2000);
            }
          });
        });

        applyEvent();
      </script>
    </section>
  </body>
</html>
